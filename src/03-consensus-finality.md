# 3. 共識、最終性與重組

## 3.1 共識模型
- Nakamoto PoW: 機率最終性，重組風險隨確認數下降
- PoS + BFT: 經濟懲罰 + 檢查點，最終性更快
- Rollup: L2 本地排序 + L1 結算最終性

## 3.2 最終性層級
- Soft Finality: 通常幾秒到幾分鐘，可能被重組
- Economic Finality: 回滾成本高，實務可視為完成
- Cryptographic Finality: 協議層不可逆（或需懲罰超過閾值）

## 3.3 重組（Reorg）工程處理
- 事件處理採「可回滾模型」
- 入帳分級: `pending` -> `confirmed(k)` -> `finalized`
- 針對大額交易提高確認數

```text
Block N      Block N+1      Block N+2
   |             |             |
   +------A------+------B------+------C-----> 主鏈
            \
             +------B'-----C'-----------> 分叉鏈(短暫)
```

## 3.4 檢查點策略
- 交易策略: 依資產風險配置確認數
- 服務策略: API 對外預設 `confirmed`，財務結算用 `finalized`
- 風控策略: 同一地址高頻提現套用延遲機制

## 白話說明
「打包進區塊」不代表 100% 定案。工程上要把「可回滾」當預設，而不是例外。
